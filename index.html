<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Creative Music Prompts</title>

<meta name="theme-color" content="#000000" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />

<style>
  :root {
    --bg:#000;
    --panel:#111;
    --panel2:#0b0b0b;
    --text:#fff;
    --muted:#bdbdbd;
    --line:#222;
    --btn:#141414;
    --btn2:#101010;
    --btnActive:#222;
  }
  body{
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin:0;
    padding:16px;
  }
  .wrap{ max-width: 820px; margin: 0 auto; }
  h1{
    text-align:center;
    font-size:1.35rem;
    margin:8px 0 14px;
    letter-spacing:.2px;
  }
  .row{
    display:grid;
    grid-template-columns:1fr;
    gap:10px;
    margin-bottom:12px;
  }
  button{
    width:100%;
    padding:14px 12px;
    font-size:1rem;
    border:1px solid var(--line);
    border-radius:12px;
    background: var(--btn);
    color: var(--text);
  }
  button:active{ background: var(--btnActive); }
  .panel{
    border:1px solid var(--line);
    border-radius:14px;
    background: var(--panel);
    padding:14px;
  }
  .titlebar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    margin-bottom:10px;
    flex-wrap:wrap;
  }
  .tag{
    font-size:0.8rem;
    color: var(--muted);
    border:1px solid var(--line);
    background: var(--panel2);
    padding:6px 10px;
    border-radius:999px;
    white-space:nowrap;
  }

  /* Card */
  #card{
    white-space:pre-wrap;
    line-height:1.5;
    font-size:1rem;
  }
  .small{ opacity:.75; font-size:.9rem; }

  /* Actions */
  .actions{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
    margin-top:12px;
  }
  .actions button{
    padding:12px;
    font-size:.95rem;
    background: var(--btn2);
  }

  /* Secondary stack */
  #secondaryWrap{
    display:none;
    margin-top:12px;
    padding-top:12px;
    border-top:1px solid var(--line);
  }
  #secondaryTitle{
    display:inline-block;
    margin-bottom:8px;
  }
  #secondaryCard{
    white-space:pre-wrap;
    line-height:1.5;
  }

  /* Timer */
  .timerBox{
    margin-top:12px;
    padding-top:12px;
    border-top:1px solid var(--line);
    display:grid;
    gap:10px;
  }
  .timerRow{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  select, input{
    background: var(--panel2);
    color: var(--text);
    border:1px solid var(--line);
    border-radius:10px;
    padding:10px 10px;
    font-size:.95rem;
  }
  input{ width: 110px; }
  .timerDisplay{
    font-variant-numeric: tabular-nums;
    font-weight:700;
    letter-spacing:.3px;
  }
  .note{
    color: var(--muted);
    font-size:.85rem;
    line-height:1.4;
  }

  /* Formatted cards (Games/Homework) */
  .fmtTitle{
    font-weight:900;
    font-size:1.05rem;
    margin-bottom:8px;
  }
  .fmtSteps{
    margin:0;
    padding-left:18px;
  }
  .fmtSteps li{
    margin:6px 0;
  }
  .fmtHint{
    margin-top:10px;
    color: var(--muted);
    font-size: .9rem;
    line-height: 1.45;
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>Creative Music Prompts</h1>

  <div class="row">
    <button onclick="draw('start')">üå± Ways to Start</button>
    <button onclick="draw('develop')">üß± Ways to Develop</button>
    <button onclick="draw('layers')">üéõÔ∏è Sound / Layer Suggestion</button>
    <button onclick="draw('unstuck')">üßØ Ways to Get Unstuck</button>
    <button onclick="draw('games')">üé≤ Collaborative Game</button>
    <button onclick="draw('homework')">üìö Homework (next session)</button>
  </div>

  <div class="panel">
    <div class="titlebar">
      <div id="categoryLabel" class="tag">Tap a category</div>
      <div id="repeatLabel" class="tag">No repeats: ON</div>
    </div>

    <div id="card" class="small">Tap a category button above to draw a prompt.</div>

    <div id="secondaryWrap">
      <div id="secondaryTitle" class="tag">Secondary (stack)</div>
      <div id="secondaryCard"></div>
    </div>

    <div class="actions">
      <button onclick="reroll()">üîÅ Re-roll</button>
      <button onclick="copyCard()">üìã Copy</button>
      <button onclick="stackSecondary()">‚ûï Stack (Develop/Layers)</button>
      <button onclick="clearStack()">üßπ Clear Stack</button>
    </div>

    <div class="timerBox">
      <div class="timerRow">
        <span class="tag">‚è±Ô∏è Timer</span>
        <select id="timerPreset" onchange="onPresetChange()">
          <option value="1">1 min</option>
          <option value="5">5 min</option>
          <option value="10" selected>10 min</option>
          <option value="15">15 min</option>
          <option value="25">25 min</option>
          <option value="45">45 min</option>
          <option value="60">60 min</option>
          <option value="custom">Custom</option>
        </select>
        <input id="timerCustom" type="number" min="1" max="240" placeholder="mins" style="display:none;" />
        <span class="tag timerDisplay" id="timerDisplay">10:00</span>
      </div>

      <div class="timerRow">
        <button onclick="startPauseTimer()" id="timerStartBtn">‚ñ∂Ô∏è Start</button>
        <button onclick="resetTimer()">‚Ü©Ô∏è Reset</button>
        <button onclick="setTimerToCardDefault()">üéØ Set to Card Default</button>
      </div>

      <div class="note">
        Tip: draw a card ‚Üí hit <b>Set to Card Default</b> ‚Üí Start.
      </div>
    </div>
  </div>
</div>

<script>
/* =========================
   YOUR PROMPTS
   ========================= */

const prompts = {
  start: [
    "Start with a pad or drone ‚Äî find a texture that evokes a mood, then build rhythm or melody around it.",
    "Play random chords until one sticks ‚Äî quantize, loop, and tweak voicings or inversions.",
    "Use an unusual chord progression generator or MIDI pack to spark ideas.",
    "Transpose a familiar progression into an unexpected mode (e.g., Dorian or Lydian).",
    "Resample old piano or guitar recordings and stretch them into a new harmonic bed.",
    "Program a simple 2-bar drum loop ‚Äî add small syncopations or ghost notes until it feels alive.",
    "Drag a breakbeat into your sampler and slice it up to make it your own.",
    "Tap a rhythm on your desk and record it as a groove template.",
    "Use random MIDI velocity or timing variations for a humanized feel.",
    "Mute the kick ‚Äî write with hats and percussion first, then reintroduce the low end later.",
    "Use a MIDI generator to generate a rhythm.",
    "Design one synth sound from scratch and let it inspire a motif.",
    "Use generative tools (like random patch generators or modular sequences).",
    "Record or import ambient field sounds ‚Äî build tempo and harmony to fit the soundscape.",
    "Layer two contrasting timbres (e.g., metallic and warm, digital and organic).",
    "Create a ‚Äúcharacter‚Äù sound (like a talking bass or evolving pad) that becomes the track‚Äôs centerpiece.",
    "Improvise a short melodic loop using one synth patch ‚Äî commit to the first take.",
    "Whistle, hum, or sing an idea into your phone, then translate it to MIDI.",
    "Sample your own voice and process it into an instrument.",
    "Use scale constraints (e.g., only white keys or only pentatonic).",
    "Generate random MIDI notes and trim down what sounds good.",
    "Pick an emotional keyword or concept (‚Äúweightless,‚Äù ‚Äúmechanical,‚Äù ‚Äúmelancholy‚Äù) and build sonically around it.",
    "Start from the middle ‚Äî make a strong 8-bar drop or climax first, then build intro and outro.",
    "Remix yourself ‚Äî open an old project and transform one element into a new piece.",
    "Use film dialogue or poetry samples as the emotional seed.",
    "Recreate the vibe of a track you love ‚Äî not the notes, just the atmosphere.",
    "Use a randomizer rule: e.g., ‚Äúevery sound must be reversed‚Äù or ‚Äúno EQ until the end.‚Äù",
    "Limit yourself to one synth and one drum machine.",
    "Record a live jam with your controller or synths, then chop out the best 20 seconds to expand.",
    "Work in Arrangement view early ‚Äî move away from loop jail fast.",
    "Resample everything ‚Äî bounce down MIDI to audio and manipulate it",
    "Set up a reverb-heavy, low-pass filtered sound and just play slowly to set the tone.",
    "Pick a tempo and key based on a reference track and build your own version.",
    "Imagine a scene or place (ocean, city at night, forest dawn) and design sounds that live there.",
    "Start from silence ‚Äî build up only what feels essential.",
    "Jam with visuals (like a short film loop or generative video) to sync emotion and rhythm."
  ],

  develop: [
    "Copy your loop across 3‚Äì4 minutes and start muting/deleting sections to sketch an arrangement.",
    "Introduce a new element every 8 bars (even subtle: automation, extra percussion, reverb send).",
    "Build contrast ‚Äî make one section dry and intimate, the next wide and lush.",
    "Create an A/B structure: duplicate your loop, reharmonize or change rhythm in B.",
    "Use energy waves ‚Äî build, release, rebuild; structure intensity like breathing.",
    "Automate filter cutoff, resonance, or LFO depth to evolve timbres over time.",
    "Double your main sound with subtle variations ‚Äî octave, stereo width, modulation.",
    "Switch up drum fills or use probability to trigger rare hits.",
    "Alternate between ‚Äúfull‚Äù and ‚Äúbare‚Äù moments ‚Äî silence is contrast.",
    "Transpose motifs up or down 3‚Äì5 semitones for development.",
    "Layer textures that come in and out like waves: pads, field recordings, shimmer verbs.",
    "Gradually modulate reverb or delay sends to create a sense of movement.",
    "Resample a synth line, reverse it, or stretch it for texture transitions.",
    "Use macro controls (in Ableton or similar) to tie multiple parameters to one expressive knob.",
    "Morph sounds using spectral processing, vocoding, or granular effects.",
    "Change swing or shuffle in different sections.",
    "Introduce rhythmic counterpoint (syncopated synth vs. straight drums).",
    "Use rhythmic gating, tremolo, or sidechain compression to animate static elements.",
    "Mute the kick temporarily to create dynamic contrast.",
    "Drop out all rhythm mid-section for an ambient bridge.",
    "Reharmonize the same melody with new chords or a pedal tone.",
    "Use risers, downlifters, sweeps, and noise bursts for section changes.",
    "Automate low-pass or high-pass filters across transitions.",
    "Introduce silence or a breakbeat moment right before a drop or chorus.",
    "Reverse key sounds or tails to lead into new sections.",
    "Time-stretch a snippet of the upcoming section as a teaser.",
    "Invert chord voicings or change extensions (maj7 ‚Üí 9 ‚Üí sus2).",
    "Add a countermelody that complements or responds to the main line.",
    "Improvise a melodic variation over the same progression, then tighten timing.",
    "Use call-and-response phrasing between instruments or textures.",
    "Shift the emotional tone ‚Äî same elements, different context (major ‚Üî minor, dark ‚Üî bright).",
    "Introduce a motif from a different world (e.g., organic sample in electronic mix).",
    "Tell a ‚Äústory‚Äù through texture ‚Äî evolving from static to chaotic or cold to warm.",
    "Let a single sound ‚Äútransform‚Äù over the track‚Äôs arc, like a protagonist‚Äôs journey.",
    "Base development on a metaphor (e.g., ‚Äúwaves‚Äù, ‚Äúawakening‚Äù, ‚Äúmachine learning to dream‚Äù).",
    "Print everything to audio and rearrange freely like collage.",
    "Apply random modulation to several parameters, then capture what works.",
    "Use extreme time-stretch or pitch-shifting for ghost versions of your parts.",
    "Freeze a moment of sound (with granular tools) and sculpt from it.",
    "Glitch or stutter slices to create new rhythmic hooks.",
    "Push one sound forward, pull another back ‚Äî balance creates movement.",
    "Take one sound and rebuild a whole new track around it.",
    "Change tempo or meter ‚Äî 4/4 to 6/8 or half-time/double-time.",
    "Flip genres: turn ambient pad loops into techno or downtempo.",
    "Collaborate with a friend ‚Äî their interpretation can push it somewhere unexpected.",
    "Mute your favorite element ‚Äî what happens when it‚Äôs gone?",
    "Automate volume swells and panning for living mixes.",
    "EQ sweep transitions ‚Äî pull low end out of a section then drop it back.",
    "Play with stereo space ‚Äî mono breakdowns vs. wide chorus.",
    "Use saturation or tape effects to ‚Äúage‚Äù sections differently."
  ],

  layers: [
    "Sustained pads or drones ‚Äî provide tonal grounding or emotional wash.",
    "Short plucks or keys ‚Äî rhythmic harmonic punctuation.",
    "Counter-chords ‚Äî use different inversions or extensions for color.",
    "Filtered reverb tails ‚Äî ghost harmonies subtly supporting the mix.",
    "Granular resamples of your main chords for evolving texture.",
    "Organ or synth-brass layers ‚Äî thickens harmony and adds midrange power.",
    "FM or wavetable pads ‚Äî introduce harmonic movement through modulation.",
    "Perc loops ‚Äî metallic, organic, or foley-based shakers for swing.",
    "Octave-doubled lead ‚Äî brighter, more assertive melody.",
    "Counter-melody ‚Äî echoes or answers the main hook.",
    "Call-and-response arps ‚Äî two different synths trading phrases.",
    "Layered unison synths ‚Äî combine analog warmth + digital clarity.",
    "Vocal chops / samples ‚Äî human texture without lyrical focus.",
    "Instrument imitation layers (guitar, flute, koto, bells) ‚Äî hybrid identity.",
    "Dissonant tension notes ‚Äî automated fade-ins for drama.",
    "Subtle hat or shaker ghost layers ‚Äî widen groove without clutter.",
    "Offbeat claps or snaps ‚Äî add syncopation and human feel.",
    "Rhythmic sidechain gates ‚Äî pulsating pad movement.",
    "Noise bursts or filtered white noise hits ‚Äî enhance transients.",
    "Percussive synth stabs ‚Äî rhythmic motifs locked with drums.",
    "Resampled glitch hits ‚Äî fills or transitions for unpredictability.",
    "Field recordings / ambient sounds (rain, city, forest, machines).",
    "Vinyl crackle / tape hiss / air movement ‚Äî lo-fi cohesion.",
    "Granular or reversed pads ‚Äî dreamy backdrop.",
    "Long-reverb hits frozen into drones.",
    "Subtle pitch-shifted harmonics ‚Äî glisten above the mix.",
    "Stereo noise washes ‚Äî widen and fill high frequencies.",
    "Evolving modulation ‚Äî slow LFOs, chorus, or phaser on textures.",
    "Sub sine / triangle wave ‚Äî pure foundation.",
    "Risers, downlifters, swells, whooshes.",
    "Filtered noise sweeps tied to section changes.",
    "Pitch-enveloped synth stabs ‚Äî accent transitions.",
    "Reverse cymbals or reverb tails.",
    "Automated ambience ‚Äî e.g., reverb size increases pre-drop.",
    "Stuttered or granular fragments ‚Äî recontextualize upcoming sound.",
    "‚ÄúPre-echo‚Äù effects hinting at the next section‚Äôs texture.",
    "Mid-bass grit layer ‚Äî adds definition and character.",
    "Sidechained bass pad ‚Äî breathes with kick pattern.",
    "Plucky sub-bass for rhythmic interest.",
    "Layer with distortion in parallel ‚Äî keep sub clean, saturate top.",
    "Reese-style detuned bass for tension or transitions.",
    "Octave-shifted bass harmonics to help translate on small speakers.",
    "Distant reverb reflections ‚Äî place elements in imagined space.",
    "Binaural-panned textures ‚Äî subtle head movement illusion.",
    "Subtle delay tails with panning automation.",
    "Reverse room tone ‚Äî adds surreal glue.",
    "Low-volume drones tuned a fifth above or below for emotional shift.",
    "Off-grid rhythmic delays ‚Äî create perceived complexity.",
    "Resampled main instrument run through distortion / grain delay.",
    "Spectral freeze / \nvocoder / convolution reverb on core sounds.",
    "Random LFO modulation of parameters for organic unpredictability.",
    "Feedback loops (tamed!) for evolving drones.",
    "Microtonal detune layers ‚Äî slight dissonance adds realism.",
    "Found sounds turned into instruments ‚Äî e.g., cutlery, breath, footsteps.",
    "Subtle string or choir pad ‚Äî lifts emotional tone.",
    "Filtered piano reverb ‚Äî nostalgic warmth.",
    "Ambient guitar or synth swells ‚Äî humanise digital edges.",
    "Low-level tonal noise bed ‚Äî glues mix like analog tape.",
    "Drone that follows root motion ‚Äî ties sections emotionally.",
    "Reverb ‚Äúghost‚Äù send bus shared across elements for cohesion."
  ],

  unstuck: [
    "Change your input. Listen to music outside your genre or revisit something that once inspired you.",
    "Set a timer for 15 minutes. Give yourself permission to make garbage ‚Äî momentum beats perfection.",
    "Switch environments. Dim the lights, put on headphones, or work in a caf√© ‚Äî fresh context = fresh ideas.",
    "Limit your tools. Pick one synth, one drum kit, one effect. Creativity thrives on constraint.",
    "Jam without recording. Play freely, explore sounds with no pressure to ‚Äúsave‚Äù anything.",
    "Mute everything but one sound. Rebuild around that.",
    "Double something an octave up or down. Instant lift or depth.",
    "Add a surprise element. Field recordings, percussive glitch, reversed pad, pitch-bent riser.",
    "Introduce movement. Automate filters, reverb send, or modulation depth across time.",
    "Change perspective. Swap the drum groove, invert chords, or reharmonize the bassline.",
    "Draw an emotional arc. Label sections ‚Äúcalm,‚Äù ‚Äúrising,‚Äù ‚Äúecstatic,‚Äù ‚Äúafterglow‚Äù ‚Äî then shape sound accordingly.",
    "Borrow a structure from a song you love (e.g., intro ‚Üí build ‚Üí drop ‚Üí break ‚Üí outro).",
    "Decide the purpose. Is this a club track? Ambient meditation? Film cue? It helps focus decisions.",
    "Zoom out. Copy your loop for 3 minutes, automate textures, and mark potential transitions.",
    "Introduce contrast. Make a ‚ÄúB-section‚Äù that flips energy or texture completely.",
    "Pretend your DAW is a 90s sampler. Only 8 tracks, no plugins ‚Äî make it work.",
    "Roll a dice or randomize a parameter. Commit to the result.",
    "Print everything to audio. Editing audio is often easier and more creative than endless tweaking.",
    "Use ‚Äúchoose one‚Äù rules: Only one reverb, one synth, one modulation effect per project.",
    "Pause to organize. Name tracks, color-code, freeze bloat ‚Äî clarity helps creativity.",
    "Delete your favorite part. Painful, but it often unlocks new directions.",
    "Move on to sound design or percussion. You‚Äôre still making progress.",
    "Bounce the section to stems, start a new project, and rearrange like Lego pieces.",
    "Switch to arrangement view and force a beginning, middle, and end.",
    "Ask: what‚Äôs this track about? If you can‚Äôt answer, define its emotional or narrative intent.",
    "Change the tempo or halve/double it. Instant mood shift.",
    "Change the sound palette. Replace instruments with acoustic samples or modular bleeps.",
    "Reverse engineer the vibe of a favorite artist‚Äôs track using your own sounds.",
    "Mash it with another unfinished project. Two half-ideas can make one whole track.",
    "Add a completely different layer (spoken word, sampled radio, guitar, sitar, anything).",
    "Do a low-stakes creative task: organize samples, name presets, tidy your project folder.",
    "Journal about what you‚Äôre trying to express ‚Äî words often reveal the missing emotion.",
    "Listen to ambient or silence. Reset your sensory threshold.",
    "Remind yourself that creative blocks are part of the cycle ‚Äî every artist hits them.",
    "Combine or cannibalize old ideas ‚Äî mix bassline from one with drums from another.",
    "End the session on a win: name one thing you learned or improved today.",
    "üß≠ Re-orient\n\nWhat am I actually doing right now ‚Äî exploring, practicing, or finishing?\n\nIf this were just a sketch, would it already be ‚Äúgood enough‚Äù?\n\nWhat‚Äôs the smallest honest next action? (one sound, one note, one pass)",
    "üëÇ Return to Listening\n\nWhat is already working in this sound?\n\nIf I mute everything but one track, what does it want?\n\nWhat happens if I stop trying to improve it and just respond to it?",
    "ü™∂ Release Pressure\n\nWho am I trying to impress right now?\n\nWhat if this piece is allowed to be private forever?\n\nWhat would change if this was only for today?",
    "üîÅ Shift the Frame\n\nIs this a practice session pretending to be a masterpiece?\n\nWhat would I do differently if I only had 10 more minutes?\n\nWhat if the point is discovery, not outcome?",
    "üå± Remember Why\n\nWhat feeling or state pulled me into making music in the first place?\n\nWhere do I feel this sound in my body, if at all?\n\nWhat would it be like to trust my taste again?",
    "üé≤ Permission Slips (use one)\n\nI am allowed to make boring music today.\n\nI am allowed to stop before it makes sense.\n\nI am allowed to follow curiosity, not clarity.\n\nI am allowed to make something no one hears.",
    "üïØÔ∏è Emergency Reset (60 seconds)\n\nClose eyes.\n\nListen to the loudest and quietest sound in the room.\n\nAsk: ‚ÄúWhat‚Äôs the most alive sound I could make right now?‚Äù\n\nDo only that, then stop."
  ]
};

/* =========================
   FORMATTED CATEGORIES
   ========================= */

const games = [
  { title: "No Talking While Playing", steps: [
    "Communicate only through sound.",
    "No verbal cues once the music starts."
  ]},
  { title: "Forbidden Tool", steps: [
    "Agree on one instrument, effect, or technique neither of you can use for the entire session."
  ]},
  { title: "Mirror & Mutate", steps: [
    "Person A plays an idea.",
    "Person B copies it exactly.",
    "Person B distorts, bends, or mutates it."
  ]},
  { title: "Tag-Team Timer", steps: [
    "Alternate control every 60‚Äì90 seconds.",
    "When time‚Äôs up, hands off."
  ]},
  { title: "Finish My Thought", steps: [
    "Person A starts an idea.",
    "Person B must finish it."
  ]},
  { title: "One Leads, One Follows", steps: [
    "Leader sets tempo/feel/direction.",
    "Follower adapts instantly.",
    "Switch roles often."
  ]},
  { title: "Carry the Torch", steps: [
    "Person A starts an idea.",
    "Person B continues it without deleting anything.",
    "Person A cannot interfere."
  ]},
  { title: "Reference Swap", steps: [
    "Each brings a reference track.",
    "Use the other person‚Äôs reference as inspiration for your part."
  ]},
  { title: "Passing the Session (Splice Style)", steps: [
    "A adds one element.",
    "Pass to B to add one element.",
    "Repeat until the track feels complete."
  ]},
  { title: "Blind Composition (Layering)", steps: [
    "Each creates a short part without hearing the other.",
    "Combine all parts at once and listen together."
  ]},
  { title: "Musical Hot Potato", steps: [
    "Fast timer.",
    "Each adds one sound/loop/idea before time runs out.",
    "Immediately pass control."
  ]},
  { title: "Genre-Switching Roulette", steps: [
    "Take an existing idea or melody.",
    "Apply a randomly chosen opposing genre."
  ]},
  { title: "Themed Soundtrack Challenge", steps: [
    "Agree on a vivid or silly scene prompt.",
    "Create a 30-second soundtrack together."
  ]}
];

const homework = [
  { title: "1) The Seed & The Soil", steps: [
    "A: Create a short, simple musical seed (10‚Äì30 seconds). One idea only.",
    "B: Create textures, harmonies, or rhythms that could support an unknown seed.",
    "Bring both, combine fresh."
  ]},
  { title: "2) Rhythm vs Atmosphere", steps: [
    "A: Build a rhythm or pulse with no harmony.",
    "B: Build a harmonic or textural piece with no rhythm.",
    "Merge and negotiate space."
  ]},
  { title: "3) Emotion Translator", steps: [
    "A: Choose a specific emotion or memory and translate it into sound.",
    "B: Choose the opposite emotion and translate that.",
    "See what happens when both coexist."
  ]},
  { title: "4) Reference Exchange", steps: [
    "A: Pick a reference track and recreate one aspect of it.",
    "B: Pick a different reference track and recreate a different aspect.",
    "Do not tell each other what you chose."
  ]},
  { title: "5) Minimal vs Maximal", steps: [
    "A: Create the most minimal version of an idea you can.",
    "B: Create the most maximal version of an idea you can.",
    "Combine and sculpt together."
  ]},
  { title: "6) Constraint Twins", steps: [
    "A: Write something using only one instrument or sound source.",
    "B: Write something while banning that same instrument or source.",
    "Forces non-overlap."
  ]},
  { title: "7) Call & Response Prep", steps: [
    "A: Write a short musical ‚Äúquestion.‚Äù",
    "B: Write a short musical ‚Äúanswer.‚Äù",
    "Do not hear each other‚Äôs work beforehand."
  ]},
  { title: "8) Field vs Studio", steps: [
    "A: Capture a field recording or organic sound.",
    "B: Create a synthetic or heavily processed sound.",
    "Fuse nature + machine."
  ]},
  { title: "9) Structure vs Freedom", steps: [
    "A: Create a rigid structure (tempo map, form, chord cycle).",
    "B: Create free material with no structure at all.",
    "Let structure tame freedom (or vice versa)."
  ]},
  { title: "10) Sound Identity", steps: [
    "A: Design one signature sound you love.",
    "B: Design one sound you actively dislike.",
    "Decide which one survives."
  ]},
  { title: "11) Unfinished Business", steps: [
    "A: Bring an unfinished idea you‚Äôve abandoned.",
    "B: Bring a brand-new idea made quickly.",
    "Swap them and continue each other‚Äôs work."
  ]},
  { title: "12) Silence & Density", steps: [
    "A: Compose something sparse with lots of silence.",
    "B: Compose something dense and continuous.",
    "Find the meeting point."
  ]},
  { title: "13) Tempo Polarity", steps: [
    "A: Write something very slow.",
    "B: Write something very fast.",
    "Stretch or compress to meet."
  ]},
  { title: "14) Mood Without Genre", steps: [
    "A: Create a piece focused purely on mood.",
    "B: Create a piece focused purely on technique.",
    "Blend feeling and craft."
  ]},
  { title: "15) One-Minute World", steps: [
    "A: Create a complete one-minute piece.",
    "B: Create a loop that could run forever.",
    "Decide where it begins and ends."
  ]},
  { title: "üß† How to Use (without overwhelm)", steps: [
    "Pick 1 homework pair per week.",
    "Keep each piece under 1 minute.",
    "Don‚Äôt polish ‚Äî sketch energy only.",
    "Bring raw files, not finished tracks."
  ]}
];

/* =========================
   APP STATE + NO REPEATS
   ========================= */

let lastCategory = null;
let lastPrimary = null;   // string or object
let lastSecondary = null; // string

const recentPicks = {
  start: [],
  develop: [],
  layers: [],
  unstuck: [],
  games: [],
  homework: []
};

const NO_REPEAT_BUFFER = 2;

function categoryName(key){
  return ({
    start: "Ways to Start",
    develop: "Ways to Develop",
    layers: "Sound / Layer Suggestion",
    unstuck: "Ways to Get Unstuck",
    games: "Collaborative Game",
    homework: "Homework (next session)"
  })[key] || key;
}

function pickIndexNoRepeat(total, category){
  if (total <= 1) return 0;
  const recent = recentPicks[category] || [];
  let idx = Math.floor(Math.random() * total);
  let attempts = 0;
  while (recent.includes(idx) && attempts < 30) {
    idx = Math.floor(Math.random() * total);
    attempts++;
  }
  recentPicks[category] = [idx, ...recent].slice(0, NO_REPEAT_BUFFER);
  return idx;
}

function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function renderFormatted(obj, targetEl, hintText){
  targetEl.innerHTML = `
    <div class="fmtTitle">${escapeHtml(obj.title)}</div>
    <ul class="fmtSteps">
      ${obj.steps.map(s => `<li>${escapeHtml(s)}</li>`).join("")}
    </ul>
    ${hintText ? `<div class="fmtHint">${escapeHtml(hintText)}</div>` : ``}
  `;
}

function renderPlain(text, targetEl){
  targetEl.textContent = text;
}

function draw(category){
  lastCategory = category;
  document.getElementById("categoryLabel").textContent = categoryName(category);
  clearStack();

  if (category === "games") {
    const idx = pickIndexNoRepeat(games.length, "games");
    lastPrimary = games[idx];
    renderFormatted(lastPrimary, document.getElementById("card"), "Optional: set timer 10 min and commit.");
    return;
  }

  if (category === "homework") {
    const idx = pickIndexNoRepeat(homework.length, "homework");
    lastPrimary = homework[idx];
    renderFormatted(lastPrimary, document.getElementById("card"), "Keep each piece under 1 minute. Bring raw files.");
    return;
  }

  const list = prompts[category] || [];
  const idx = pickIndexNoRepeat(list.length, category);
  lastPrimary = list[idx] || "(No prompts found)";
  renderPlain(lastPrimary, document.getElementById("card"));
}

function reroll(){
  if (!lastCategory) draw("start");
  else draw(lastCategory);
}

/* =========================
   STACKING (Develop/Layers)
   ========================= */

function stackSecondary(){
  if (!lastCategory || (lastCategory !== "develop" && lastCategory !== "layers")) {
    showSecondary("Stacking only works for Develop or Layers.\n\nTip: draw Develop or Layers first, then Stack.");
    return;
  }
  const list = prompts[lastCategory] || [];
  if (!list.length) return;

  let idx = pickIndexNoRepeat(list.length, lastCategory);
  let candidate = list[idx];

  let tries = 0;
  while (candidate === lastPrimary && tries < 20) {
    idx = pickIndexNoRepeat(list.length, lastCategory);
    candidate = list[idx];
    tries++;
  }

  lastSecondary = candidate;
  showSecondary(candidate);
}

function showSecondary(text){
  const wrap = document.getElementById("secondaryWrap");
  const card = document.getElementById("secondaryCard");
  wrap.style.display = "block";
  card.textContent = text;
}

function clearStack(){
  lastSecondary = null;
  document.getElementById("secondaryWrap").style.display = "none";
  document.getElementById("secondaryCard").textContent = "";
}

/* =========================
   COPY
   ========================= */

function copyCard(){
  if (!lastCategory || !lastPrimary) return;

  let text = `Category: ${categoryName(lastCategory)}\n\n`;

  if (lastCategory === "games" || lastCategory === "homework") {
    text += `${lastCategory.toUpperCase()}: ${lastPrimary.title}\n`;
    for (const s of lastPrimary.steps) text += `- ${s}\n`;
  } else {
    text += `PRIMARY:\n${lastPrimary}\n`;
    if (lastSecondary) text += `\nSECONDARY (STACK):\n${lastSecondary}\n`;
  }

  navigator.clipboard.writeText(text).then(() => {
    flashTag("repeatLabel", "Copied ‚úì", 900);
  }).catch(() => {
    alert("Could not copy (some iPhones block copy in certain contexts).");
  });
}

function flashTag(id, msg, ms){
  const el = document.getElementById(id);
  const old = el.textContent;
  el.textContent = msg;
  setTimeout(() => el.textContent = old, ms);
}

/* =========================
   TIMER + BEEP
   ========================= */

let timerTotalSec = 10 * 60;
let timerRemainingSec = timerTotalSec;
let timerRunning = false;
let timerHandle = null;

function formatTime(sec){
  sec = Math.max(0, Math.floor(sec));
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${m}:${String(s).padStart(2,"0")}`;
}
function updateTimerDisplay(){
  document.getElementById("timerDisplay").textContent = formatTime(timerRemainingSec);
}
function getSelectedMinutes(){
  const preset = document.getElementById("timerPreset").value;
  if (preset === "custom") {
    const v = parseInt(document.getElementById("timerCustom").value, 10);
    return isFinite(v) && v > 0 ? v : 10;
  }
  return parseInt(preset, 10);
}
function onPresetChange(){
  const preset = document.getElementById("timerPreset").value;
  const custom = document.getElementById("timerCustom");
  custom.style.display = (preset === "custom") ? "inline-block" : "none";
  resetTimer();
}
function resetTimer(){
  stopTimerInternal();
  const mins = getSelectedMinutes();
  timerTotalSec = mins * 60;
  timerRemainingSec = timerTotalSec;
  updateTimerDisplay();
  document.getElementById("timerStartBtn").textContent = "‚ñ∂Ô∏è Start";
}

function playBeep(){
  try {
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    const ctx = new AudioCtx();
    const o = ctx.createOscillator();
    const g = ctx.createGain();

    o.type = "sine";
    o.frequency.value = 880; // pitch
    g.gain.value = 0.05;     // gentle volume

    o.connect(g);
    g.connect(ctx.destination);

    o.start();
    setTimeout(() => {
      o.stop();
      ctx.close();
    }, 220);
  } catch (e) {
    // If blocked, do nothing
  }
}

function startPauseTimer(){
  if (!timerRunning) {
    timerRunning = true;
    document.getElementById("timerStartBtn").textContent = "‚è∏Ô∏è Pause";
    timerHandle = setInterval(() => {
      timerRemainingSec -= 1;
      updateTimerDisplay();
      if (timerRemainingSec <= 0) {
        stopTimerInternal();
        timerRemainingSec = 0;
        updateTimerDisplay();
        document.getElementById("timerStartBtn").textContent = "‚ñ∂Ô∏è Start";
        flashTag("repeatLabel", "Timer done ‚úì", 1200);
        playBeep();
        if (navigator.vibrate) navigator.vibrate([80, 60, 80]);
      }
    }, 1000);
  } else {
    stopTimerInternal();
    document.getElementById("timerStartBtn").textContent = "‚ñ∂Ô∏è Start";
  }
}
function stopTimerInternal(){
  timerRunning = false;
  if (timerHandle) {
    clearInterval(timerHandle);
    timerHandle = null;
  }
}
function setTimerToCardDefault(){
  const defaults = { start:10, develop:15, layers:8, unstuck:15, games:10, homework:10 };
  const mins = defaults[lastCategory] || 10;
  document.getElementById("timerPreset").value = String(mins);
  document.getElementById("timerCustom").style.display = "none";
  resetTimer();
}
updateTimerDisplay();
</script>

</body>
</html>
